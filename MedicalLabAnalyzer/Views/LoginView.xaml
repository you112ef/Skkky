<UserControl x:Class="MedicalLabAnalyzer.Views.LoginView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             FlowDirection="RightToLeft"
             FontFamily="Segoe UI, Arial"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <!-- Custom Styles for Arabic Medical Theme -->
        <Style x:Key="LoginCardStyle" TargetType="materialDesign:Card">
            <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp8"/>
            <Setter Property="Padding" Value="32"/>
            <Setter Property="Margin" Value="32"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="16"/>
        </Style>
        
        <Style x:Key="LoginHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="32"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#1976D2"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,24"/>
        </Style>
        
        <Style x:Key="MedicalIconStyle" TargetType="materialDesign:PackIcon">
            <Setter Property="Width" Value="64"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="Foreground" Value="#1976D2"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <Style x:Key="LoginButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Height" Value="48"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="#1976D2"/>
            <Setter Property="BorderBrush" Value="#1976D2"/>
            <Setter Property="Margin" Value="0,16,0,8"/>
        </Style>

        <Style x:Key="ErrorTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#F44336"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,8,0,0"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <!-- Animation Storyboards -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                           From="20" To="0" Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="ShakeAnimation">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.05" Value="-10"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="10"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="-10"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="10"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.25" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInAnimation}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <UserControl.RenderTransform>
        <TranslateTransform/>
    </UserControl.RenderTransform>

    <Grid>
        <!-- Background with Medical Pattern -->
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#E3F2FD" Offset="0"/>
                <GradientStop Color="#BBDEFB" Offset="0.5"/>
                <GradientStop Color="#90CAF9" Offset="1"/>
            </LinearGradientBrush>
        </Grid.Background>

        <!-- Medical Pattern Background -->
        <Border Opacity="0.1">
            <Border.Background>
                <ImageBrush ImageSource="pack://application:,,,/Resources/medical_pattern.png" 
                           TileMode="Tile" Viewport="0,0,200,200" ViewportUnits="Absolute"/>
            </Border.Background>
        </Border>

        <!-- Loading Overlay -->
        <Grid Name="LoadingOverlay" 
              Background="#80000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
              Panel.ZIndex="999">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <materialDesign:PackIcon Kind="Loading" 
                                       Width="48" Height="48" 
                                       Foreground="White"
                                       HorizontalAlignment="Center">
                    <materialDesign:PackIcon.RenderTransform>
                        <RotateTransform/>
                    </materialDesign:PackIcon.RenderTransform>
                    <materialDesign:PackIcon.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                   From="0" To="360" Duration="0:0:1"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </materialDesign:PackIcon.Triggers>
                </materialDesign:PackIcon>
                <TextBlock Text="جاري تسجيل الدخول..." 
                         Foreground="White" 
                         FontSize="16" 
                         Margin="0,16,0,0"
                         HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="500">
            <materialDesign:Card Style="{StaticResource LoginCardStyle}">
                <StackPanel>
                    <!-- Logo and Title -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,32">
                        <materialDesign:PackIcon Kind="MedicalBag" Style="{StaticResource MedicalIconStyle}"/>
                        <StackPanel Margin="16,0,0,0">
                            <TextBlock Text="محلل المختبرات الطبية" Style="{StaticResource LoginHeaderStyle}"/>
                            <TextBlock Text="Medical Lab Analyzer" 
                                     FontSize="14" 
                                     Foreground="#757575"
                                     TextAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Login Form -->
                    <StackPanel>
                        <!-- Username Field -->
                        <materialDesign:Card materialDesign:ElevationAssist.Elevation="Dp2" 
                                           Margin="0,0,0,16" 
                                           Padding="0">
                            <Grid>
                                <TextBox Name="UsernameTextBox"
                                       Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                                       materialDesign:HintAssist.Hint="اسم المستخدم"
                                       materialDesign:HintAssist.HintOpacity="0.6"
                                       materialDesign:HintAssist.IsFloating="True"
                                       materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                       materialDesign:TextFieldAssist.LeadingIcon="Account"
                                       materialDesign:TextFieldAssist.LeadingIconSize="20"
                                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                       FontSize="16"
                                       Height="56"
                                       VerticalContentAlignment="Center"/>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Password Field -->
                        <materialDesign:Card materialDesign:ElevationAssist.Elevation="Dp2" 
                                           Margin="0,0,0,16" 
                                           Padding="0">
                            <Grid>
                                <PasswordBox Name="PasswordBox"
                                           materialDesign:HintAssist.Hint="كلمة المرور"
                                           materialDesign:HintAssist.HintOpacity="0.6"
                                           materialDesign:HintAssist.IsFloating="True"
                                           materialDesign:TextFieldAssist.HasLeadingIcon="True"
                                           materialDesign:TextFieldAssist.LeadingIcon="Lock"
                                           materialDesign:TextFieldAssist.LeadingIconSize="20"
                                           materialDesign:PasswordBoxAssist.Password="{Binding Password, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                           Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                                           FontSize="16"
                                           Height="56"
                                           VerticalContentAlignment="Center"/>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Remember Me Checkbox -->
                        <CheckBox Name="RememberMeCheckBox"
                                Content="تذكرني"
                                IsChecked="{Binding RememberMe}"
                                Margin="0,8,0,16"
                                Style="{StaticResource MaterialDesignCheckBox}"/>

                        <!-- Login Button -->
                        <Button Name="LoginButton"
                              Content="تسجيل الدخول"
                              Command="{Binding LoginCommand}"
                              Style="{StaticResource LoginButtonStyle}"
                              IsDefault="True">
                            <Button.RenderTransform>
                                <TranslateTransform/>
                            </Button.RenderTransform>
                        </Button>

                        <!-- Error Message -->
                        <TextBlock Name="ErrorMessageBlock"
                                 Text="{Binding ErrorMessage}"
                                 Style="{StaticResource ErrorTextStyle}"
                                 Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock.RenderTransform>
                                <TranslateTransform/>
                            </TextBlock.RenderTransform>
                            <TextBlock.Triggers>
                                <DataTrigger Binding="{Binding HasError}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource ShakeAnimation}" 
                                                       Storyboard.TargetName="ErrorMessageBlock"/>
                                    </DataTrigger.EnterActions>
                                </DataTrigger>
                            </TextBlock.Triggers>
                        </TextBlock>

                        <!-- Additional Options -->
                        <StackPanel Orientation="Horizontal" 
                                  HorizontalAlignment="Center" 
                                  Margin="0,24,0,0">
                            <Button Content="نسيت كلمة المرور؟"
                                  Command="{Binding ForgotPasswordCommand}"
                                  Style="{StaticResource MaterialDesignFlatButton}"
                                  Foreground="#1976D2"
                                  FontSize="12"/>
                        </StackPanel>

                        <!-- Version Info -->
                        <TextBlock Text="الإصدار 2.0.0 | AI-Powered Medical Analysis"
                                 FontSize="10"
                                 Foreground="#9E9E9E"
                                 TextAlignment="Center"
                                 Margin="0,24,0,0"/>

                        <!-- System Status -->
                        <StackPanel Orientation="Horizontal" 
                                  HorizontalAlignment="Center" 
                                  Margin="0,8,0,0">
                            <materialDesign:PackIcon Kind="Database" 
                                                   Width="12" Height="12" 
                                                   Foreground="{Binding DatabaseStatusColor}"
                                                   VerticalAlignment="Center"
                                                   Margin="4,0"/>
                            <TextBlock Text="قاعدة البيانات"
                                     FontSize="10"
                                     Foreground="#9E9E9E"
                                     VerticalAlignment="Center"/>
                            
                            <materialDesign:PackIcon Kind="Brain" 
                                                   Width="12" Height="12" 
                                                   Foreground="{Binding AIStatusColor}"
                                                   VerticalAlignment="Center"
                                                   Margin="16,0,4,0"/>
                            <TextBlock Text="الذكاء الاصطناعي"
                                     FontSize="10"
                                     Foreground="#9E9E9E"
                                     VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </materialDesign:Card>
        </Grid>

        <!-- Footer -->
        <StackPanel HorizontalAlignment="Center" 
                   VerticalAlignment="Bottom" 
                   Margin="32" 
                   Opacity="0.7">
            <TextBlock Text="© 2024 Medical Lab Analyzer - AI Powered"
                     FontSize="10"
                     Foreground="#555555"
                     TextAlignment="Center"/>
            <TextBlock Text="Offline Medical Analysis System"
                     FontSize="9"
                     Foreground="#777777"
                     TextAlignment="Center"/>
        </StackPanel>
    </Grid>
</UserControl>